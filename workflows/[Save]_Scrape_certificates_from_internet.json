[{"parameters":{},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.4,"position":[-64,-64],"id":"2e71a02b-ac5a-4e92-8c66-ddc76fc24ad2","name":"When chat message received","webhookId":"b6422db4-82c3-41a3-8396-1d24fce5fd51"},{"parameters":{"promptType":"define","text":"={{ $json.chatInput }}","options":{"systemMessage":"# Context\n- Use the `SerpApi` tool to search google for details that user provided about the target organization.\n- Use the `Http Request` tool to fetch and scrape all certificate information from the provided link.\n- Your task is to retrieve **every certification** listed on that page, extract all relevant details, and transform them into the output pattern below.\n- Ensure **no certification is missing** and all fields are accurately populated.\n\n# Output Format\nReturn the final result as an array of objects using the following structure:\n\n[\n  {\n    \"source\": \"istqb\",\n    \"type\": \"certification\",\n    \"org\": \"International Software Testing Qualifications Board\",\n    \"achievementName\": \"Certified Tester Foundation Level (CTFL) v4.0\",\n    \"code\": \"CTFL v4.0\",\n    \"url\": \"https://istqb.org/certifications/certified-tester-foundation-level-ctfl-v4-0/\",\n    \"imageUrl\": \"https://istqb.org/wp-content/uploads/2024/10/istqb-ctfl-4-logo.jpg.avif\"\n  },\n  {\n    \"source\": \"istqb\",\n    \"type\": \"certification\",\n    \"org\": \"International Software Testing Qualifications Board\",\n    \"achievementName\": \"Certified Another name\",\n    \"code\": \"CTFL v4.0\",\n    \"url\": \"https://istqb.org/certifications/certified-tester-foundation-level-ctfl-v4-0/\",\n    \"imageUrl\": \"https://istqb.org/wp-content/uploads/2024/10/istqb-ctfl-4-logo.jpg.avif\"\n  },\n  ... // include all remaining certifications\n]"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[144,-64],"id":"c7e348f6-b260-4573-a619-e936dfb0ad8b","name":"AI Agent"},{"parameters":{"modelName":"models/gemini-2.5-pro","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[80,144],"id":"81f8d8d5-1bcb-40c2-9a38-a7a5a3f1791d","name":"Google Gemini Chat Model"},{"parameters":{},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.3,"position":[512,144],"id":"08907ad1-08c5-47e3-b681-b48cc5826566","name":"HTTP Request"},{"parameters":{"contextWindowLength":10},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[240,208],"id":"6a7cc8ba-bfaf-4327-b6ad-861884a3c883","name":"Simple Memory"},{"parameters":{"descriptionType":"manual","toolDescription":"Use this tool for search in google by SerpApi","q":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Search_Query__q_', ``, 'string') }}","location":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Location__location_', ``, 'string') }}","additionalFields":{},"requestOptions":{}},"type":"n8n-nodes-serpapi.serpApiTool","typeVersion":1,"position":[400,192],"id":"c9a61eb7-0d94-4d23-8104-f648160cc454","name":"SerpApi","credentials":{"serpApi":{"id":"88gxCimGPbQeyAF6","name":"SerpApi account"}}},{"parameters":{"jsCode":"const input = $input.first().json.output\n\nif (input === \"\") {\n  return []\n}\n\nconst cleaned = input\n  .replace(/```json/, \"\")\n  .replace(/```/, \"\")\n  .trim();\n// Step 1: Parse outer JSON\nconst arr = JSON.parse(cleaned);\n\nconsole.log(arr);\n// return {\n//    data: arr\n// }\n\nreturn arr"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[560,-32],"id":"e14493bc-6229-4135-9809-1c6574848272","name":"Code in JavaScript"},{"parameters":{"operation":"toJson","options":{"format":false,"fileName":"={{ $input.first().json.source.trim() }}.json"}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[736,-16],"id":"7275a00e-e4b8-491a-9a64-9b8e31b9eb1d","name":"Convert to File"}]